<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">.lst-kix_rd441v3p7f36-7>li:before{content:"" counter(lst-ctn-kix_rd441v3p7f36-7,lower-latin) ". "}.lst-kix_rd441v3p7f36-8>li:before{content:"" counter(lst-ctn-kix_rd441v3p7f36-8,lower-roman) ". "}.lst-kix_rd441v3p7f36-6>li:before{content:"" counter(lst-ctn-kix_rd441v3p7f36-6,decimal) ". "}.lst-kix_rd441v3p7f36-4>li:before{content:"" counter(lst-ctn-kix_rd441v3p7f36-4,lower-latin) ". "}.lst-kix_rd441v3p7f36-1>li{counter-increment:lst-ctn-kix_rd441v3p7f36-1}ul.lst-kix_652w6yf76ze2-8{list-style-type:none}.lst-kix_rd441v3p7f36-5>li:before{content:"" counter(lst-ctn-kix_rd441v3p7f36-5,lower-roman) ". "}.lst-kix_rd441v3p7f36-0>li:before{content:"" counter(lst-ctn-kix_rd441v3p7f36-0,decimal) ". "}.lst-kix_dauvmwz26wyz-8>li:before{content:"-  "}ul.lst-kix_652w6yf76ze2-3{list-style-type:none}ul.lst-kix_652w6yf76ze2-2{list-style-type:none}ul.lst-kix_652w6yf76ze2-1{list-style-type:none}ul.lst-kix_652w6yf76ze2-0{list-style-type:none}.lst-kix_rd441v3p7f36-2>li:before{content:"" counter(lst-ctn-kix_rd441v3p7f36-2,lower-roman) ". "}ul.lst-kix_652w6yf76ze2-7{list-style-type:none}ul.lst-kix_652w6yf76ze2-6{list-style-type:none}.lst-kix_rd441v3p7f36-3>li:before{content:"" counter(lst-ctn-kix_rd441v3p7f36-3,decimal) ". "}.lst-kix_dauvmwz26wyz-5>li:before{content:"-  "}ul.lst-kix_652w6yf76ze2-5{list-style-type:none}ul.lst-kix_652w6yf76ze2-4{list-style-type:none}.lst-kix_dauvmwz26wyz-6>li:before{content:"-  "}.lst-kix_rd441v3p7f36-1>li:before{content:"" counter(lst-ctn-kix_rd441v3p7f36-1,lower-latin) ". "}.lst-kix_dauvmwz26wyz-7>li:before{content:"-  "}.lst-kix_rd441v3p7f36-2>li{counter-increment:lst-ctn-kix_rd441v3p7f36-2}ol.lst-kix_rd441v3p7f36-0.start{counter-reset:lst-ctn-kix_rd441v3p7f36-0 0}ol.lst-kix_rd441v3p7f36-3.start{counter-reset:lst-ctn-kix_rd441v3p7f36-3 0}ol.lst-kix_rd441v3p7f36-6.start{counter-reset:lst-ctn-kix_rd441v3p7f36-6 0}.lst-kix_652w6yf76ze2-6>li:before{content:"-  "}.lst-kix_652w6yf76ze2-5>li:before{content:"-  "}.lst-kix_652w6yf76ze2-4>li:before{content:"-  "}.lst-kix_652w6yf76ze2-3>li:before{content:"-  "}.lst-kix_652w6yf76ze2-0>li:before{content:"-  "}.lst-kix_652w6yf76ze2-2>li:before{content:"-  "}.lst-kix_652w6yf76ze2-1>li:before{content:"-  "}ol.lst-kix_rd441v3p7f36-2.start{counter-reset:lst-ctn-kix_rd441v3p7f36-2 0}.lst-kix_dauvmwz26wyz-0>li:before{content:"-  "}ol.lst-kix_rd441v3p7f36-0{list-style-type:none}.lst-kix_dauvmwz26wyz-1>li:before{content:"-  "}.lst-kix_dauvmwz26wyz-4>li:before{content:"-  "}.lst-kix_dauvmwz26wyz-2>li:before{content:"-  "}.lst-kix_dauvmwz26wyz-3>li:before{content:"-  "}ul.lst-kix_5ztvnl5pv6t8-2{list-style-type:none}ul.lst-kix_5ztvnl5pv6t8-1{list-style-type:none}ul.lst-kix_5ztvnl5pv6t8-4{list-style-type:none}.lst-kix_rd441v3p7f36-3>li{counter-increment:lst-ctn-kix_rd441v3p7f36-3}ul.lst-kix_5ztvnl5pv6t8-3{list-style-type:none}ol.lst-kix_rd441v3p7f36-1.start{counter-reset:lst-ctn-kix_rd441v3p7f36-1 0}ol.lst-kix_rd441v3p7f36-8.start{counter-reset:lst-ctn-kix_rd441v3p7f36-8 0}ul.lst-kix_5ztvnl5pv6t8-0{list-style-type:none}.lst-kix_rd441v3p7f36-0>li{counter-increment:lst-ctn-kix_rd441v3p7f36-0}ul.lst-kix_vytk61pr8l4b-8{list-style-type:none}ul.lst-kix_5ztvnl5pv6t8-6{list-style-type:none}ul.lst-kix_5ztvnl5pv6t8-5{list-style-type:none}ul.lst-kix_5ztvnl5pv6t8-8{list-style-type:none}ul.lst-kix_5ztvnl5pv6t8-7{list-style-type:none}ul.lst-kix_vytk61pr8l4b-2{list-style-type:none}ul.lst-kix_vytk61pr8l4b-3{list-style-type:none}ul.lst-kix_vytk61pr8l4b-0{list-style-type:none}ol.lst-kix_rd441v3p7f36-4.start{counter-reset:lst-ctn-kix_rd441v3p7f36-4 0}.lst-kix_vytk61pr8l4b-0>li:before{content:"-  "}ul.lst-kix_vytk61pr8l4b-1{list-style-type:none}ul.lst-kix_vytk61pr8l4b-6{list-style-type:none}ul.lst-kix_vytk61pr8l4b-7{list-style-type:none}ul.lst-kix_vytk61pr8l4b-4{list-style-type:none}.lst-kix_vytk61pr8l4b-1>li:before{content:"-  "}ul.lst-kix_vytk61pr8l4b-5{list-style-type:none}.lst-kix_rd441v3p7f36-6>li{counter-increment:lst-ctn-kix_rd441v3p7f36-6}.lst-kix_vytk61pr8l4b-7>li:before{content:"-  "}.lst-kix_vytk61pr8l4b-6>li:before{content:"-  "}.lst-kix_vytk61pr8l4b-5>li:before{content:"-  "}ol.lst-kix_rd441v3p7f36-3{list-style-type:none}ol.lst-kix_rd441v3p7f36-4{list-style-type:none}ol.lst-kix_rd441v3p7f36-1{list-style-type:none}ol.lst-kix_rd441v3p7f36-2{list-style-type:none}.lst-kix_vytk61pr8l4b-2>li:before{content:"-  "}.lst-kix_vytk61pr8l4b-4>li:before{content:"-  "}ol.lst-kix_rd441v3p7f36-7{list-style-type:none}ol.lst-kix_rd441v3p7f36-7.start{counter-reset:lst-ctn-kix_rd441v3p7f36-7 0}ol.lst-kix_rd441v3p7f36-8{list-style-type:none}ol.lst-kix_rd441v3p7f36-5{list-style-type:none}ol.lst-kix_rd441v3p7f36-6{list-style-type:none}.lst-kix_vytk61pr8l4b-3>li:before{content:"-  "}.lst-kix_vytk61pr8l4b-8>li:before{content:"-  "}.lst-kix_rd441v3p7f36-4>li{counter-increment:lst-ctn-kix_rd441v3p7f36-4}.lst-kix_rd441v3p7f36-7>li{counter-increment:lst-ctn-kix_rd441v3p7f36-7}.lst-kix_652w6yf76ze2-7>li:before{content:"-  "}.lst-kix_652w6yf76ze2-8>li:before{content:"-  "}.lst-kix_rd441v3p7f36-8>li{counter-increment:lst-ctn-kix_rd441v3p7f36-8}.lst-kix_5ztvnl5pv6t8-7>li:before{content:"-  "}ol.lst-kix_rd441v3p7f36-5.start{counter-reset:lst-ctn-kix_rd441v3p7f36-5 0}.lst-kix_rd441v3p7f36-5>li{counter-increment:lst-ctn-kix_rd441v3p7f36-5}ul.lst-kix_dauvmwz26wyz-7{list-style-type:none}.lst-kix_5ztvnl5pv6t8-6>li:before{content:"-  "}.lst-kix_5ztvnl5pv6t8-8>li:before{content:"-  "}ul.lst-kix_dauvmwz26wyz-8{list-style-type:none}ul.lst-kix_dauvmwz26wyz-1{list-style-type:none}ul.lst-kix_dauvmwz26wyz-2{list-style-type:none}.lst-kix_5ztvnl5pv6t8-4>li:before{content:"-  "}ul.lst-kix_dauvmwz26wyz-0{list-style-type:none}ul.lst-kix_dauvmwz26wyz-5{list-style-type:none}.lst-kix_5ztvnl5pv6t8-5>li:before{content:"-  "}ul.lst-kix_dauvmwz26wyz-6{list-style-type:none}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}ul.lst-kix_dauvmwz26wyz-3{list-style-type:none}ul.lst-kix_dauvmwz26wyz-4{list-style-type:none}.lst-kix_5ztvnl5pv6t8-0>li:before{content:"-  "}.lst-kix_5ztvnl5pv6t8-3>li:before{content:"-  "}.lst-kix_5ztvnl5pv6t8-2>li:before{content:"-  "}.lst-kix_5ztvnl5pv6t8-1>li:before{content:"-  "}ol{margin:0;padding:0}table td,table th{padding:0}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:11pt}.c5{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c3{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c9{background-color:#000000;font-size:10.5pt;font-family:"Courier New";color:#00a67d;font-weight:400}.c8{background-color:#000000;font-size:10.5pt;font-family:"Courier New";color:#2e95d3;font-weight:400}.c6{background-color:#000000;font-size:10.5pt;font-family:"Courier New";color:#df3079;font-weight:400}.c4{background-color:#000000;font-size:10.5pt;font-family:"Courier New";color:#ffffff;font-weight:400}.c1{background-color:#000000;font-size:10.5pt;font-family:"Courier New";color:#f22c3d;font-weight:400}.c11{background-color:#000000;font-size:10.5pt;font-family:"Courier New";font-weight:400}.c13{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c7{text-decoration:none;vertical-align:baseline;font-style:normal}.c12{padding:0;margin:0}.c10{margin-left:36pt;padding-left:0pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c13 doc-content"><div><p class="c0"><span class="c5"></span></p></div><p class="c2"><span class="c3">Blog Post: Crafting a WebAudio DJ Kit - A Journey into Computational Sound</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">The integration of audio capabilities has opened up exciting possibilities for creating immersive and interactive user experiences. Our mission was to develop a user-friendly, feature-rich &quot;DJ kit&quot; in WebAudio, blending a polished frontend with multiple backend functionalities. This blog post will delve into the design choices, implementation details, and the road traveled so far in our computational sound project.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">All the functionalities were implemented using WebAudio, leveraging its powerful features to generate and manipulate audio in real-time. From simulating instruments to recording and playback, the WebAudio proved to be a versatile tool for our project.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">The frontend was carefully thought through to prioritize user experience. The piano and drum simulator, with dynamic lighting, not only mimics real-world instruments but also enhances the interactive aspect of the DJ kit. We tried to make the user experience as fun and intuitive as possible!</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c3">Project Vision and Objectives</span></p><p class="c2"><span class="c5">Our vision was to empower users to craft multipart compositions effortlessly, enabling them to switch between instrument modes such as piano, harp, uploading samples, drum kits, and more. The primary goal was to facilitate the creation, modification, and layering of musical parts similar to professional tools like GarageBand. Recognizing the potential complexity of audio tools, we made a conscious decision to prioritize usability without compromising on features.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c3">Proposed Features</span></p><p class="c2"><span class="c5">The initial feature set outlined our ambition to create a comprehensive DJ kit. Some of the proposed features included:</span></p><p class="c0"><span class="c5"></span></p><ul class="c12 lst-kix_vytk61pr8l4b-0 start"><li class="c2 c10 li-bullet-0"><span class="c5">Instrument Modes: Switching between keystroke-driven instrument modes, with presets simulating real instruments through filtering or synthesis, a drum kit, and potentially a piano.</span></li></ul><p class="c0"><span class="c5"></span></p><ul class="c12 lst-kix_5ztvnl5pv6t8-0 start"><li class="c2 c10 li-bullet-0"><span class="c5">Customizable Oscillators: Allowing users to modify the oscillation of recorded parts through synthesis, filtering, and other parameters.</span></li></ul><p class="c0"><span class="c5"></span></p><ul class="c12 lst-kix_dauvmwz26wyz-0 start"><li class="c2 c10 li-bullet-0"><span class="c5">Recording and Playback: Enabling users to record and repeat parts seamlessly, providing a foundational element for creating complex compositions.</span></li></ul><p class="c0"><span class="c5"></span></p><ul class="c12 lst-kix_652w6yf76ze2-0 start"><li class="c2 c10 li-bullet-0"><span class="c5">Microphone Input: Integrating voice recording and the ability to overlay recorded voice over compositions.</span></li></ul><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">Fine-grained Control: Individually controlling audio parameters for each part, including filters, playback speed, pitch, gain, and ADSR (Attack, Decay, Sustain, Release) settings.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c3">Progress So Far</span></p><p class="c2"><span class="c5">1. Piano Keyboard and Drum Simulator</span></p><p class="c2"><span class="c5">Our journey began with the implementation of a piano keyboard and drum simulator. The keyboard lights up dynamically as users press corresponding keys, providing a visual and auditory feedback loop.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">2. Voice and Audio Recording</span></p><p class="c2"><span class="c5">We successfully implemented voice recording, allowing users to capture their voice, listen to the recording, and even download it for further use as a .wav file. Additionally, audio recording capabilities were integrated, enabling users to play the piano and drum and record their compositions.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c3">The Drum Kit Component</span></p><p class="c2"><span class="c5">Event-driven Drumming</span></p><p class="c2"><span class="c5">Our drum kit component is built on the backbone of event-driven programming. We utilize JavaScript event listeners to capture both keydown and keyup events, translating them into drum beats. The playSound function fires on keydown, triggering the playback of the associated audio clip. Conversely, the stopSound function activates on keyup, halting the sound when a key is released.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c6">document</span><span class="c4">.</span><span class="c1">addEventListener</span><span class="c4">(</span><span class="c9">&#39;keydown&#39;</span><span class="c4 c7">, playSound);</span></p><p class="c2"><span class="c6">document</span><span class="c4">.</span><span class="c1">addEventListener</span><span class="c4">(</span><span class="c9">&#39;keyup&#39;</span><span class="c4">, stopSound);</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">Drum Pad Interaction</span></p><p class="c2"><span class="c5">Each drum pad on our virtual drum kit responds visually to user interaction. When a key is pressed, the corresponding drum pad becomes &quot;active,&quot; providing visual feedback to the user. This is achieved by adding and removing the &quot;active&quot; class using JavaScript.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c8">if</span><span class="c4 c7">&nbsp;(drumPad) {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; drumPad.classList.</span><span class="c1">add</span><span class="c4">(</span><span class="c9">&quot;active&quot;</span><span class="c4 c7">);</span></p><p class="c2"><span class="c4 c7">}</span></p><p class="c2"><span class="c11">// ...</span></p><p class="c2"><span class="c8">if</span><span class="c4 c7">&nbsp;(drumPad){</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; drumPad.classList.</span><span class="c1">remove</span><span class="c4">(</span><span class="c9">&quot;active&quot;</span><span class="c4 c7">);</span></p><p class="c2"><span class="c4">}</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">Smooth Audio Playback Control</span></p><p class="c2"><span class="c5">To ensure seamless audio playback, we employ the end event listener on each audio element. When a drum sound finishes playing, this event triggers, allowing us to reset the playback time and stop the audio if the key is not being held.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c4">audioElement.</span><span class="c1">addEventListener</span><span class="c4">(</span><span class="c9">&#39;ended&#39;</span><span class="c4 c7">, () =&gt; {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; </span><span class="c11">// ...</span></p><p class="c2"><span class="c4">});</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">The Drum Kit in Action</span></p><p class="c2"><span class="c5">Our drum component boasts a set of virtual drum pads, each associated with a unique key on the keyboard. Users can trigger drum sounds by pressing the corresponding keys, and the visual feedback adds an immersive touch to the experience.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c4">&lt;div </span><span class="c6">class</span><span class="c4">=</span><span class="c9">&quot;drum-pad drum&quot;</span><span class="c4">&nbsp;</span><span class="c6">id</span><span class="c4">=</span><span class="c9">&quot;hi-hat&quot;</span><span class="c4">&nbsp;</span><span class="c6">data-key</span><span class="c4">=</span><span class="c9">&quot;Q&quot;</span><span class="c4 c7">&gt;</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; </span><span class="c11">&lt;!-- ... --&gt;</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &lt;audio </span><span class="c6">class</span><span class="c4">=</span><span class="c9">&quot;clip&quot;</span><span class="c4">&nbsp;</span><span class="c6">id</span><span class="c4">=</span><span class="c9">&quot;Q&quot;</span><span class="c4">&nbsp;</span><span class="c6">src</span><span class="c4">=</span><span class="c9">&quot;https://s3.amazonaws.com/freecodecamp/drums/Dsc_Oh.mp3&quot;</span><span class="c4 c7">&gt;&lt;/audio&gt;</span></p><p class="c2"><span class="c4 c7">&lt;/div&gt;</span></p><p class="c0"><span class="c4 c7"></span></p><p class="c2"><span class="c3">The Piano Component</span></p><p class="c0"><span class="c3"></span></p><p class="c2"><span class="c5">Initialization and Configuration</span></p><p class="c2"><span class="c5">The piano component kicks off with the initialization of essential variables, including the piano compressor, audio context, and parameters defining the attack, decay, sustain, and release (ADSR) times. These foundational elements set the stage for crafting a dynamic and responsive piano experience.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c8">const</span><span class="c4">&nbsp;pianoCompr = </span><span class="c6">window</span><span class="c4 c7">.globalCompr;</span></p><p class="c2"><span class="c8">const</span><span class="c4">&nbsp;audioCtx = </span><span class="c6">window</span><span class="c4 c7">.audioCtx;</span></p><p class="c2"><span class="c8">const</span><span class="c4 c7">&nbsp;activeOscs = {};</span></p><p class="c2"><span class="c8">const</span><span class="c4 c7">&nbsp;activeGains = {};</span></p><p class="c2"><span class="c8">const</span><span class="c4 c7">&nbsp;asdrTimes = {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; </span><span class="c6">attack</span><span class="c4">: </span><span class="c6">0.1</span><span class="c4 c7">,</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; </span><span class="c6">release</span><span class="c4">: </span><span class="c6">0.2</span><span class="c4 c7">,</span></p><p class="c2"><span class="c4">};</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">User Interaction and Mode Selection</span></p><p class="c2"><span class="c5">The code responds to user interactions, such as pressing keys on the piano keyboard. It detects the active state of the piano component, the selected mode (oscillator, piano, harpsichord, or custom), and updates the visibility of the sample upload feature accordingly. </span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">Implementing so many shapes with a normal-looking alignment seemed really complicated with only CSS shapes/style tags seemed daunting, and we knew there was a better way. Although we have never used Figma, we decided to learn for this project for the sake of the piano. &nbsp;The piano itself is an SVG, each path (key) with a distinct ID, that is programmatically filled on keyUps/keyDowns. The CSS involved with getting the piano to respond to key presses was unexpectedly complicated and ate up a lot of time, but we are happy with the result!</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c4">pianoIsActive = </span><span class="c6">document</span><span class="c4">.</span><span class="c1">getElementById</span><span class="c4">(</span><span class="c9">&quot;piano-tab&quot;</span><span class="c4">).classList.</span><span class="c1">contains</span><span class="c4">(</span><span class="c9">&quot;active&quot;</span><span class="c4 c7">);</span></p><p class="c2"><span class="c8">var</span><span class="c4">&nbsp;modeSelector = </span><span class="c6">document</span><span class="c4">.</span><span class="c1">getElementById</span><span class="c4">(</span><span class="c9">&quot;mode&quot;</span><span class="c4 c7">);</span></p><p class="c2"><span class="c8">var</span><span class="c4 c7">&nbsp;mode = modeSelector.value;</span></p><p class="c2"><span class="c4">modeSelector.</span><span class="c1">addEventListener</span><span class="c4">(</span><span class="c9">&quot;change&quot;</span><span class="c4">, showSampleUpload);</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">Audio Initialization and Oscillator Sounds</span></p><p class="c2"><span class="c5">The initAudio function initializes the audio context and dynamics compressor, ensuring that the piano sounds are crisp and well-controlled. The playNote function dynamically generates piano sounds based on user input, with options for oscillators, sample-based piano, harpsichord, and custom audio sampling.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c8">function</span><span class="c4">&nbsp;</span><span class="c1">initAudio</span><span class="c4 c7">() {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; pianoCompr = audioCtx.</span><span class="c1">createDynamicsCompressor</span><span class="c4 c7">();</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; pianoCompr.release.</span><span class="c1">setValueAtTime</span><span class="c4 c7">(asdrTimes.release, audioCtx.currentTime);</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; pianoCompr.attack.</span><span class="c1">setValueAtTime</span><span class="c4 c7">(asdrTimes.release, audioCtx.currentTime);</span></p><p class="c2"><span class="c4">}</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">Loading and Playing Samples</span></p><p class="c2"><span class="c5">The piano component incorporates versatility through sample-based playback. Whether simulating a piano, harpsichord, or allowing users to upload custom audio samples, the code seamlessly handles loading and playing diverse sounds. The playSample function takes care of adjusting playback rates based on MIDI note differences, allowing for pitch variation. </span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c8">function</span><span class="c4">&nbsp;</span><span class="c1">loadSample</span><span class="c4 c7">(url) {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; </span><span class="c8">return</span><span class="c4">&nbsp;</span><span class="c1">fetch</span><span class="c4 c7">(url)</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; .</span><span class="c1">then</span><span class="c4">((response) =&gt; response.</span><span class="c1">arrayBuffer</span><span class="c4 c7">())</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; .</span><span class="c1">then</span><span class="c4">((buffer) =&gt; audioCtx.</span><span class="c1">decodeAudioData</span><span class="c4 c7">(buffer));</span></p><p class="c2"><span class="c4 c7">}</span></p><p class="c0"><span class="c4 c7"></span></p><p class="c2"><span class="c8">function</span><span class="c4">&nbsp;</span><span class="c1">loadSampleFromInput</span><span class="c4 c7">(file) {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; </span><span class="c8">return</span><span class="c4">&nbsp;file.</span><span class="c1">arrayBuffer</span><span class="c4">().</span><span class="c1">then</span><span class="c4">((buffer) =&gt; audioCtx.</span><span class="c1">decodeAudioData</span><span class="c4 c7">(buffer));</span></p><p class="c2"><span class="c4 c7">}</span></p><p class="c0"><span class="c4 c7"></span></p><p class="c2"><span class="c3">The Voice Recording Component</span></p><p class="c0"><span class="c3"></span></p><p class="c2"><span class="c5">Initialization and Event Handling</span></p><p class="c2"><span class="c5">The code commences by initializing essential variables, such as the state of voice recording, an array to store voice audio chunks, and a MediaRecorder object for handling audio data. Event listeners are set up to toggle voice recording, play the recorded voice, and initiate the download process.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">Toggling Voice Recording</span></p><p class="c2"><span class="c5">The toggleVoiceRec function handles the toggle mechanism for voice recording. It starts or stops the recording based on the current state, updating the visual indicator accordingly.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c8">function</span><span class="c4">&nbsp;</span><span class="c1">toggleVoiceRec</span><span class="c4 c7">() {</span></p><p class="c2"><span class="c4">&nbsp; </span><span class="c8">if</span><span class="c4 c7">&nbsp;(!voiceRecording) {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; </span><span class="c1">startVoiceRecording</span><span class="c4 c7">();</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; </span><span class="c6">document</span><span class="c4">.</span><span class="c1">getElementById</span><span class="c4">(</span><span class="c9">&quot;microphone&quot;</span><span class="c4">).classList.</span><span class="c1">add</span><span class="c4">(</span><span class="c9">&quot;rec-voice-active&quot;</span><span class="c4 c7">);</span></p><p class="c2"><span class="c4">&nbsp; } </span><span class="c8">else</span><span class="c4 c7">&nbsp;{</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; </span><span class="c1">stopVoiceRecording</span><span class="c4 c7">();</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; </span><span class="c6">document</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; .</span><span class="c1">getElementById</span><span class="c4">(</span><span class="c9">&quot;microphone&quot;</span><span class="c4 c7">)</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; .classList.</span><span class="c1">remove</span><span class="c4">(</span><span class="c9">&quot;rec-voice-active&quot;</span><span class="c4 c7">);</span></p><p class="c2"><span class="c4 c7">&nbsp; }</span></p><p class="c2"><span class="c4 c7">&nbsp; voiceRecording = !voiceRecording;</span></p><p class="c2"><span class="c4">&nbsp; </span><span class="c6">console</span><span class="c4">.</span><span class="c1">log</span><span class="c4">(</span><span class="c9">&quot;toggle rec:&quot;</span><span class="c4 c7">, voiceRecording);</span></p><p class="c2"><span class="c4">}</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">Starting Voice Recording</span></p><p class="c2"><span class="c5">When the user initiates voice recording, the startVoiceRecording function requests access to the microphone, sets up a MediaRecorder, and defines the event handlers for data availability and recording stop.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c4 c7">navigator.mediaDevices</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; .</span><span class="c1">getUserMedia</span><span class="c4">({ </span><span class="c6">audio</span><span class="c4">: </span><span class="c8">true</span><span class="c4 c7">&nbsp;})</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; .</span><span class="c1">then</span><span class="c4">(</span><span class="c8">function</span><span class="c4 c7">&nbsp;(stream) {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; voiceMediaRecorder = </span><span class="c8">new</span><span class="c4">&nbsp;</span><span class="c1">MediaRecorder</span><span class="c4 c7">(stream);</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; voiceMediaRecorder.ondataavailable = </span><span class="c8">function</span><span class="c4 c7">&nbsp;(event) {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c8">if</span><span class="c4">&nbsp;(event.data.size &gt; </span><span class="c6">0</span><span class="c4 c7">) {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; voiceAudioChunks.</span><span class="c1">push</span><span class="c4 c7">(event.data);</span></p><p class="c2"><span class="c4 c7">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c2"><span class="c4 c7">&nbsp; &nbsp; &nbsp; };</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; voiceMediaRecorder.onstop = </span><span class="c8">function</span><span class="c4 c7">&nbsp;() {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c8">const</span><span class="c4">&nbsp;voiceAudioBlob = </span><span class="c8">new</span><span class="c4">&nbsp;</span><span class="c1">Blob</span><span class="c4 c7">(voiceAudioChunks, {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c6">type</span><span class="c4">: </span><span class="c9">&quot;audio/wav&quot;</span><span class="c4 c7">,</span></p><p class="c2"><span class="c4 c7">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; voiceAudioElement.src = </span><span class="c6">URL</span><span class="c4">.</span><span class="c1">createObjectURL</span><span class="c4 c7">(voiceAudioBlob);</span></p><p class="c2"><span class="c4 c7">&nbsp; &nbsp; &nbsp; };</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; voiceMediaRecorder.</span><span class="c1">start</span><span class="c4 c7">();</span></p><p class="c2"><span class="c4 c7">&nbsp; &nbsp; })</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">Stopping and Playing Voice Recording</span></p><p class="c2"><span class="c5">The stopVoiceRecording function stops the MediaRecorder and displays a download link for the recorded voice. The playVoiceRecording function plays the recorded voice and provides visual feedback by adding a &quot;play-active&quot; class during playback.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">Downloading the Recording</span></p><p class="c2"><span class="c5">The downloadRecording function generates a download link for the recorded voice, allowing users to save the audio recording.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c8">function</span><span class="c4">&nbsp;</span><span class="c1">downloadRecording</span><span class="c4 c7">() {</span></p><p class="c0"><span class="c4 c7"></span></p><p class="c2"><span class="c4">&nbsp; </span><span class="c8">const</span><span class="c4">&nbsp;downloadLink = </span><span class="c6">document</span><span class="c4">.</span><span class="c1">createElement</span><span class="c4">(</span><span class="c9">&quot;a&quot;</span><span class="c4 c7">);</span></p><p class="c2"><span class="c4 c7">&nbsp; downloadLink.href = voiceAudioElement.src;</span></p><p class="c2"><span class="c4">&nbsp; downloadLink.download = </span><span class="c9">&quot;audio_recording.wav&quot;</span><span class="c4 c7">;</span></p><p class="c0"><span class="c4 c7"></span></p><p class="c2"><span class="c4">&nbsp; downloadLink.</span><span class="c1">click</span><span class="c4 c7">();</span></p><p class="c2"><span class="c4">}</span></p><p class="c2"><span class="c5">The Recording Component</span></p><p class="c2"><span class="c5">Initialization and Event Handling</span></p><p class="c2"><span class="c5">The code begins by initializing essential variables, including the audio context and compressor, as well as the state of recording and the starting times of keystrokes. We had to make the AudioContext and DynamicsCompressor global variables tied to the window. Event listeners are set up to toggle recording, record keystrokes, and play back the recorded sequence.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">Toggling Recording</span></p><p class="c2"><span class="c5">Similar to the voice recording, toggleRec function for recording instruments manages the toggle mechanism for recording. It initializes or finalizes the recording state and updates the visual indicator accordingly.</span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c5">Recording Keystrokes</span></p><p class="c2"><span class="c5">The recordKeyStroke and endKeyStroke functions handle the recording of keystrokes, capturing the start and end times of played notes. Then, the playRecording function orchestrates the playback of the recorded musical sequence. It sorts the recorded notes by start time and iterates through them, playing the corresponding notes on the selected instrument. Right now the only instrument that recording is possible for is the oscillator, but with some reworking we could expand it.</span></p><p class="c0"><span class="c5"></span></p><p class="c0"><span class="c5"></span></p><p class="c2"><span class="c8">function</span><span class="c4">&nbsp;</span><span class="c1">recordKeyStroke</span><span class="c4 c7">(e) {</span></p><p class="c2"><span class="c4">&nbsp; </span><span class="c8">const</span><span class="c4">&nbsp;key = (e.detail || e.which).</span><span class="c1">toString</span><span class="c4 c7">();</span></p><p class="c2"><span class="c4">&nbsp; </span><span class="c8">if</span><span class="c4 c7">&nbsp;(recording &amp;&amp; keyValToFreq[key] &amp;&amp; !keyStarts[key]) {</span></p><p class="c2"><span class="c4 c7">&nbsp; &nbsp; keyStarts[key] = audioCtx.currentTime;</span></p><p class="c2"><span class="c4 c7">&nbsp; }</span></p><p class="c2"><span class="c4 c7">}</span></p><p class="c0"><span class="c4 c7"></span></p><p class="c2"><span class="c8">function</span><span class="c4">&nbsp;</span><span class="c1">endKeyStroke</span><span class="c4 c7">(e) {</span></p><p class="c2"><span class="c4">&nbsp; </span><span class="c8">const</span><span class="c4">&nbsp;key = (e.detail || e.which).</span><span class="c1">toString</span><span class="c4 c7">();</span></p><p class="c2"><span class="c4">&nbsp; </span><span class="c8">if</span><span class="c4 c7">&nbsp;(keyStarts[key] &amp;&amp; keyValToFreq[key] &amp;&amp; recording) {</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; notesInRecording.</span><span class="c1">push</span><span class="c4 c7">({</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; </span><span class="c6">instrument</span><span class="c4 c7">: activeInstrument,</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; </span><span class="c6">keyVal</span><span class="c4 c7">: key,</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; </span><span class="c6">start</span><span class="c4 c7">: keyStarts[key],</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; &nbsp; </span><span class="c6">end</span><span class="c4 c7">: audioCtx.currentTime,</span></p><p class="c2"><span class="c4 c7">&nbsp; &nbsp; });</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; </span><span class="c11">// remove key from keyStarts, we have wrapped up this keypress</span></p><p class="c2"><span class="c4">&nbsp; &nbsp; keyStarts[key] = </span><span class="c8">null</span><span class="c4 c7">;</span></p><p class="c2"><span class="c4 c7">&nbsp; }</span></p><p class="c2"><span class="c4 c7">}</span></p><p class="c0"><span class="c4 c7"></span></p><p class="c0"><span class="c5"></span></p></body></html>